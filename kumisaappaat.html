<input class="selector-switch npc" name="attr_npcswitch" type="checkbox" value="1">
<input class="selector-switch nba" name="attr_sheetswitch" type="radio" value="nba">

<div class="master-container">

<input class="main-options options-flag" type="checkbox" name="attr_sheet-options-flag"><span>y</span>

<div class="main-settings container">
	<div class="content">
		<div class="input-row top-row">
			<label data-i18n="system:-o">System: </label>
			<select name="attr_sheetsettings">
				<option data-i18n="trail-of-cthulhu-o" value="toc" selected="true">Trail of Cthulhu</option>
				<option data-i18n="nights-black-agents-o" value="nba">Night's Black Agents</option>
			</select>
			<label data-i18n="npc:-o">NPC: </label>
			<input name="attr_npcswitch" type="checkbox" value="1">
		</div>
	</div>
	<div class="content npc-hide">
		<div class="input-row">
			<label data-i18n="inv-build-points">Investigative Build Points: </label>
			<input name="attr_inv_points_max" type="number" value="16">
			<label data-i18n="gen-build-points">General Build Points: </label>
			<input name="attr_gen_points_max" type="number" value="65">
		</div>
	</div>
	<div class="content starting-abilities npc-hide">
		<h4 data-i18n="ability-starting-o">Ability Starting Values</h4>
		<div class="input-row">
			<label data-i18n="health:-o">Health: </label>
			<input name="attr_health_default" type="number" value="1">
			<label data-i18n="stability:-o">Stability: </label>
			<input name="attr_stability_default" type="number" value="1">
		</div>
	</div>
</div>

<div class="main-container container" style="float: left">
	<div class="toc-col header npc-full">
		<img class="toc-hide" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Gumshoe%20by%20Roll20/images/nba/nba-title.png" />
	</div>
	<!-- NPC Info -->
	<div class="col section npc-full pc-hide">
		<div class="content">
			<div class="input-row name">
				<label data-i18n="name:-n">Name:</label>
				<input type="text" name="attr_character_name">
			</div>
			<div class="input-row npc-mods">
				<div>
					<label data-i18n="alertness:-n">Alertness:</label>
					<input type="number" name="attr_npc-alertness-mod">
				</div>
				<div>
					<label  data-i18n="stealth:-n">Stealth:</label>
					<input type="number" name="attr_npc-stealth-mod">
				</div>
				<div>
					<label data-i18n="hit-rating:-n">Hit Rating:</label>
					<input type="number" name="attr_hit-rating">
				</div>
			</div>
		</div>
	</div>
	<!-- Agent Info -->
	<div class="col section toc-col-right nba-col1 nba-left nba-caps npc-hide">
		<div class="content">
			<div class="input-row">
				<label data-i18n="agent-name-i">Agent Name</label>
				<input type="text" name="attr_character_name">
			</div>
			<div class="input-row">
				<label data-i18n="occupation-i">Occupation</label>
				<input type="text" name="attr_character-occupation">
			</div>
		</div>
	</div>
	<!-- Health/Stability -->
	<div class="tables toc-col1 nba-col2 nba-caps npc-hide">
		<div class="section" style="width: 100%">
			<div class="content">
				<div class="nba-col">
					<div class="table-head" style="display: block; float: left">
						<div data-i18n="health-h">Health</div>
					</div>
					<div class="table-flex" style="margin-top: 0;">
						<div><input type="radio" name="attr_health" value="-12"><span>-12</span></div>
						<div><input type="radio" name="attr_health" value="-11"><span>-11</span></div>
						<div><input type="radio" name="attr_health" value="-10"><span>-10</span></div>
						<div><input type="radio" name="attr_health" value="-9"><span>-9</span></div>
						<div><input type="radio" name="attr_health" value="-8"><span>-8</span></div>
						<div><input type="radio" name="attr_health" value="-7"><span>-7</span></div>
						<div><input type="radio" name="attr_health" value="-6"><span>-6</span></div>
						<div><input type="radio" name="attr_health" value="-5"><span>-5</span></div>
						<div><input type="radio" name="attr_health" value="-4"><span>-4</span></div>
						<div><input type="radio" name="attr_health" value="-3"><span>-3</span></div>
						<div><input type="radio" name="attr_health" value="-2"><span>-2</span></div>
						<div><input type="radio" name="attr_health" value="-1"><span>-1</span></div>
						<div><input type="radio" name="attr_health" value="0"><span>0</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="0">
						<div><input type="radio" name="attr_health" value="1"><span>1</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="1">
						<div><input type="radio" name="attr_health" value="2"><span>2</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="2">
						<div><input type="radio" name="attr_health" value="3"><span>3</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="3">
						<div><input type="radio" name="attr_health" value="4"><span>4</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="4">
						<div><input type="radio" name="attr_health" value="5"><span>5</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="5">
						<div><input type="radio" name="attr_health" value="6"><span>6</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="6">
						<div><input type="radio" name="attr_health" value="7"><span>7</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="7">
						<div><input type="radio" name="attr_health" value="8"><span>8</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="8">
						<div><input type="radio" name="attr_health" value="9"><span>9</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="9">
						<div><input type="radio" name="attr_health" value="10"><span>10</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="10">
						<div><input type="radio" name="attr_health" value="11"><span>11</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="11">
						<div><input type="radio" name="attr_health" value="12"><span>12</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="12">
						<div><input type="radio" name="attr_health" value="13"><span>13</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="13">
						<div><input type="radio" name="attr_health" value="14"><span>14</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="14">
						<div><input type="radio" name="attr_health" value="15"><span>15</span></div>
						<input class="max-marker" type="radio" name="attr_health_max" value="15">
					</div>
					<div class="footer">
						<span>
							<b data-i18n="hit-rating-h">Hit Rating</b>: <input type="number" name="attr_hit-rating" value="3">
						</span>
					</div>
				</div>
				<div class="nba-col-right">
					<div class="table-head">
						<div data-i18n="stability-h">Stability</div>
					</div>
					<div class="table-flex">
						<div><input type="radio" name="attr_stability" value="-12"><span>-12</span></div>
						<div><input type="radio" name="attr_stability" value="-11"><span>-11</span></div>
						<div><input type="radio" name="attr_stability" value="-10"><span>-10</span></div>
						<div><input type="radio" name="attr_stability" value="-9"><span>-9</span></div>
						<div><input type="radio" name="attr_stability" value="-8"><span>-8</span></div>
						<div><input type="radio" name="attr_stability" value="-7"><span>-7</span></div>
						<div><input type="radio" name="attr_stability" value="-6"><span>-6</span></div>
						<div><input type="radio" name="attr_stability" value="-5"><span>-5</span></div>
						<div><input type="radio" name="attr_stability" value="-4"><span>-4</span></div>
						<div><input type="radio" name="attr_stability" value="-3"><span>-3</span></div>
						<div><input type="radio" name="attr_stability" value="-2"><span>-2</span></div>
						<div><input type="radio" name="attr_stability" value="-1"><span>-1</span></div>
						<div><input type="radio" name="attr_stability" value="0"><span>0</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="0">
						<div><input type="radio" name="attr_stability" value="1"><span>1</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="1">
						<div><input type="radio" name="attr_stability" value="2"><span>2</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="2">
						<div><input type="radio" name="attr_stability" value="3"><span>3</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="3">
						<div><input type="radio" name="attr_stability" value="4"><span>4</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="4">
						<div><input type="radio" name="attr_stability" value="5"><span>5</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="5">
						<div><input type="radio" name="attr_stability" value="6"><span>6</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="6">
						<div><input type="radio" name="attr_stability" value="7"><span>7</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="7">
						<div><input type="radio" name="attr_stability" value="8"><span>8</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="8">
						<div><input type="radio" name="attr_stability" value="9"><span>9</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="9">
						<div><input type="radio" name="attr_stability" value="10"><span>10</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="10">
						<div><input type="radio" name="attr_stability" value="11"><span>11</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="11">
						<div><input type="radio" name="attr_stability" value="12"><span>12</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="12">
						<div><input type="radio" name="attr_stability" value="13"><span>13</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="13">
						<div><input type="radio" name="attr_stability" value="14"><span>14</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="14">
						<div><input type="radio" name="attr_stability" value="15"><span>15</span></div>
						<input class="max-marker" type="radio" name="attr_stability_max" value="15">
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Armor -->
	<div class="col section nba-full nba-left npc-full toc-hide resistances">
		<div class="content">
			<div class="armor armor-type">
				<div>
					<label data-i18n="armor" class="nba-caps">Armor:</label>
					<select name="attr_armor-type">
						<option data-i18n="none-u" value="none" selected="true">None</option>
						<option data-i18n="ballistic-cloth" value="balistic-cloth">Ballistic Cloth</option>
						<option data-i18n="police-vest" value="police-vest">Police Vest</option>
						<option data-i18n="military-armor" value="military-armor">Military Armor</option>
						<option data-i18n="other" value="other">Other</option>
					</select>
				</div>
			</div>
			<div class="armor resist">
				<h4 data-i18n="damage-resistances">Damage Resistances</h4>
				<div>
					<div>
						<label data-i18n="bullets:-r">Bullets:</label>
						<input type="number" name="attr_bullet-reduction" value="0">
					</div>
					<div>
						<label data-i18n="melee:-r">Melee:</label>
						<input type="number" name="attr_melee-reduction" value="0">
					</div>
					<div>
						<label data-i18n="explosives:-r">Explosives:</label>
						<input type="number" name="attr_explosive-reduction" value="0">
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Abilities -->
	<div class="toc-col2 toc-right nba-full npc-full" style="display: inline-block;">
		<div class="section ability-section">
			<div class="content" style="font-size: 11px;">
				<input class="edit npc-hide" name="attr_edit-abilities" type="checkbox" value="1" checked><span class="npc-hide"></span>

				<div class="ability-edit npc-hide">
					<div class="build-points">
						<div>
							<span data-i18n="inv-build-points" class="light">Investigative Build Points: </span>
							<span name="attr_inv_points"></span><span>/</span><span name="attr_inv_points_max"></span>
						</div>
						<div>
							<span data-i18n="gen-build-points" class="light">General Build Points: </span>
							<span name="attr_gen_points"></span><span>/</span><span name="attr_gen_points_max"></span>
						</div>
					</div>
					<input name="attr_spinner" type="radio" value="" checked style="display: none;">

					<div class="reset">
						<div class="placeholder reset-inv">
							<span data-i18n="reset-investigative">Reset Investigative</span>
							<input class="reset" name="attr_spinner" type="radio" value="reset-inv">
						</div>
						<div class="placeholder reset-gen">
							<span data-i18n="reset-general">Reset General</span>
							<input class="reset" name="attr_spinner" type="radio" value="reset-gen">
						</div>
					</div>
				</div>

				<div class="abilities">
					<input class="free" type="checkbox" value="1"><span data-i18n="free-points">Free Points</span>

					<div class="abilities-col">
						<div class="abilities-header">
							<span data-i18n="academic-abilities-nba" class="toc-hide">ACADEMIC ABILITIES</span>
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_accounting_constraint" type="hidden" value="abd">
							<input name="attr_accounting_dice" type="hidden" value="@{basic_roll}">
							
							<span class="inv-ability">
								<input class="available" name="attr_accounting" type="number" required><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="accounting_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="accounting_dec"></label>
								</div><span>/</span><input class="max" name="attr_accounting_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="accounting_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="accounting_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_accounting_free" type="number" value="0" min="0">
							<span data-i18n="accounting-a" class="abilities-title">Accounting</span>
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_anthropology_constraint" type="hidden" value="abd">
							<input name="attr_anthropology_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="anthropology-a" class="abilities-title">Anthropology</span>						
							<span class="inv-ability">
								<input class="available" name="attr_anthropology" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="anthropology_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="anthropology_dec"></label>
								</div><span>/</span><input class="max" name="attr_anthropology_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="anthropology_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="anthropology_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_anthropology_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_archaeology_constraint" type="hidden" value="abd">
							<input name="attr_archaeology_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="archaeology-a" class="abilities-title">Archaeology</span>						
							<span class="inv-ability">
								<input class="available" name="attr_archaeology" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="archaeology_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="archaeology_dec"></label>
								</div><span>/</span><input class="max" name="attr_archaeology_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="archaeology_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="archaeology_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_archaeology_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_architecture_constraint" type="hidden" value="abd">
							<input name="attr_architecture_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="architecture-a" class="abilities-title">Architecture</span>						
							<span class="inv-ability">
								<input class="available" name="attr_architecture" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="architecture_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="architecture_dec"></label>
								</div><span>/</span><input class="max" name="attr_architecture_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="architecture_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="architecture_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_architecture_free" typwe="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_astronomy_constraint" type="hidden" value="abd">
							<input name="attr_astronomy_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="astronomy-a" class="abilities-title">Astronomy</span>						
							<span class="inv-ability">
								<input class="available" name="attr_astronomy" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="astronomy_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="astronomy_dec"></label>
								</div><span>/</span><input class="max" name="attr_astronomy_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="astronomy_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="astronomy_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_astronomy_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_art-history_constraint" type="hidden" value="abd">
							<input name="attr_art-history_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="art-history-a" class="abilities-title">Art History</span>						
							<span class="inv-ability">
								<input class="available" name="attr_art-history" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="art-history_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="art-history_dec"></label>
								</div><span>/</span><input class="max" name="attr_art-history_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="art-history_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="art-history_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_art-history_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_biology_constraint" type="hidden" value="abd">
							<input name="attr_biology_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="biology-a" class="abilities-title">Biology</span>						
							<span class="inv-ability">
								<input class="available" name="attr_biology" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="biology_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="biology_dec"></label>
								</div><span>/</span><input class="max" name="attr_biology_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="biology_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="biology_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_biology_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_history_constraint" type="hidden" value="abd">
							<input name="attr_history_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="history-a" class="abilities-title">History</span>						
							<span class="inv-ability">
								<input class="available" name="attr_history" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="history_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="history_dec"></label>
								</div><span>/</span><input class="max" name="attr_history_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="history_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="history_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_history_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_languages_constraint" type="hidden" value="abd">
							<input name="attr_languages_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="languages-a" class="abilities-title">Languages</span>						
							<span class="inv-ability">
								<input class="available" name="attr_languages" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="languages_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="languages_dec"></label>
								</div><span>/</span><input class="max" name="attr_languages_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="languages_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="languages_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_languages_free" type="number" value="0" min="0">
							<fieldset class="repeating_r-languages">
								<div class="subsection">
									<input type="text" name="attr_r-language">
								</div>
							</fieldset>
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_linguistics_constraint" type="hidden" value="abd">
							<input name="attr_linguistics_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="linguistics-a" class="abilities-title">Linguistics</span>						
							<span class="inv-ability">
								<input class="available" name="attr_linguistics" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="linguistics_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="linguistics_dec"></label>
								</div><span>/</span><input class="max" name="attr_linguistics_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="linguistics_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="linguistics_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_linguistics_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_law_constraint" type="hidden" value="abd">
							<input name="attr_law_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="law-a" class="abilities-title">Law</span>						
							<span class="inv-ability">
								<input class="available" name="attr_law" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="law_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="law_dec"></label>
								</div><span>/</span><input class="max" name="attr_law_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="law_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="law_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_law_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_medicine_constraint" type="hidden" value="abd">
							<input name="attr_medicine_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="medicine-a" class="abilities-title">Medicine</span>						
							<span class="inv-ability">
								<input class="available" name="attr_medicine" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="medicine_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="medicine_dec"></label>
								</div><span>/</span><input class="max" name="attr_medicine_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="medicine_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="medicine_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_medicine_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_occult_constraint" type="hidden" value="abd">
							<input name="attr_occult_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="occult-a" class="abilities-title">Occult</span>						
							<span class="inv-ability">
								<input class="available" name="attr_occult" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="occult_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="occult_dec"></label>
								</div><span>/</span><input class="max" name="attr_occult_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="occult_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="occult_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_occult_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_physics_constraint" type="hidden" value="abd">
							<input name="attr_physics_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="physics-a" class="abilities-title">Physics</span>						
							<span class="inv-ability">
								<input class="available" name="attr_physics" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="physics_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="physics_dec"></label>
								</div><span>/</span><input class="max" name="attr_physics_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="physics_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="physics_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_physics_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_trivia_constraint" type="hidden" value="abd">
							<input name="attr_trivia_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="trivia-a" class="abilities-title">trivia</span>						
							<span class="inv-ability">
								<input class="available" name="attr_trivia" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="trivia_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="trivia_dec"></label>
								</div><span>/</span><input class="max" name="attr_trivia_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="trivia_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="trivia_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_trivia_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_psychology_constraint" type="hidden" value="abd">
							<input name="attr_psychology_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="psychology-a" class="abilities-title">Psychology</span>						
							<span class="inv-ability">
								<input class="available" name="attr_psychology" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="psychology_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="psychology_dec"></label>
								</div><span>/</span><input class="max" name="attr_psychology_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="psychology_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="psychology_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_psychology_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_textual-analysis_constraint" type="hidden" value="abd">
							<input name="attr_textual-analysis_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="textual-analysis-a" class="abilities-title">Textual Analysis</span>						
							<span class="inv-ability">
								<input class="available" name="attr_textual-analysis" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="textual-analysis_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="textual-analysis_dec"></label>
								</div><span>/</span><input class="max" name="attr_textual-analysis_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="textual-analysis_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="textual-analysis_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_textual-analysis_free" type="number" value="0" min="0">
						</div>
						<fieldset class="repeating_academic">
							<div class="abilities-item">
								<input class="constraint" name="attr_r-academic_constraint" type="hidden" value="abd">
								<input name="attr_r-academic_dice" type="hidden" value="@{basic_roll}">
								<div class="rep-title">
									<input class="options-flag" type="checkbox" name="attr_r-academic_options-flag" checked="checked">
									<span>y</span>
									<div class="options">
										<input type="text" name="attr_r-academic_title">
									</div>
									<div class="display">
										<span type="roll" class="abilities-title rep-title">
											<span name="attr_r-academic_title"></span>
										</span>
									</div>
								</div>
								<span>
									<input class="available" name="attr_r-academic" type="number"><div>
										<label class="increment"><input name="attr_r-academic_inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-academic_dec" type="checkbox" value="1"></label>
									</div><span>/</span><input class="max" name="attr_r-academic_max" type="number" value="0"><div>
										<label class="increment"><input name="attr_r-academic_max-inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-academic_max-dec" type="checkbox" value="1"></label>
									</div>
								</span>
								<input class="free-points" name="attr_r-academic_free" type="number" value="0" min="0">
							</div>
						</fieldset>
					</div>
					<div class="abilities-col">
						<div class="abilities-header">
							<span data-i18n="interpersonal-abilities-nba" class="toc-hide">INTERPERSONAL ABILITIES</span>
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_bullshit-detector_constraint" type="hidden" value="abd">
							<input name="attr_bullshit-detector_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="bullshit-detector-a" class="abilities-title">Bullshit Detector</span>						
							<span class="inv-ability">
								<input class="available" name="attr_bullshit-detector" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="bullshit-detector_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="bullshit-detector_dec"></label>
								</div><span>/</span><input class="max" name="attr_bullshit-detector_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="bullshit-detector_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="bullshit-detector_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_bullshit-detector_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_cop-talk_constraint" type="hidden" value="abd">
							<input name="attr_cop-talk_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="cop-talk-a" class="abilities-title">Cop Talk</span>						
							<span class="inv-ability">
								<input class="available" name="attr_cop-talk" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="cop-talk_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="cop-talk_dec"></label>
								</div><span>/</span><input class="max" name="attr_cop-talk_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="cop-talk_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="cop-talk_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_cop-talk_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_flattery_constraint" type="hidden" value="abd">
							<input name="attr_flattery_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="flattery-a" class="abilities-title">Flattery</span>						
							<span class="inv-ability">
								<input class="available" name="attr_flattery" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="flattery_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="flattery_dec"></label>
								</div><span>/</span><input class="max" name="attr_flattery_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="flattery_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="flattery_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_flattery_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_interrogation_constraint" type="hidden" value="abd">
							<input name="attr_interrogation_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="interrogation-a" class="abilities-title">Interrogation</span>						
							<span class="inv-ability">
								<input class="available" name="attr_interrogation" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="interrogation_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="interrogation_dec"></label>
								</div><span>/</span><input class="max" name="attr_interrogation_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="interrogation_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="interrogation_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_interrogation_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_intimidation_constraint" type="hidden" value="abd">
							<input name="attr_intimidation_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="intimidation-a" class="abilities-title">Intimidation</span>						
							<span class="inv-ability">
								<input class="available" name="attr_intimidation" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="intimidation_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="intimidation_dec"></label>
								</div><span>/</span><input class="max" name="attr_intimidation_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="intimidation_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="intimidation_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_intimidation_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_negotiation_constraint" type="hidden" value="abd">
							<input name="attr_negotiation_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="negotiation-a" class="abilities-title">Negotiation</span>						
							<span class="inv-ability">
								<input class="available" name="attr_negotiation" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="negotiation_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="negotiation_dec"></label>
								</div><span>/</span><input class="max" name="attr_negotiation_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="negotiation_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="negotiation_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_negotiation_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_reassurance_constraint" type="hidden" value="abd">
							<input name="attr_reassurance_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="reassurance-a" class="abilities-title">Reassurance</span>						
							<span class="inv-ability">
								<input class="available" name="attr_reassurance" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="reassurance_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="reassurance_dec"></label>
								</div><span>/</span><input class="max" name="attr_reassurance_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="reassurance_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="reassurance_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_reassurance_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_streetwise_constraint" type="hidden" value="abd">
							<input name="attr_streetwise_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="streetwise-a" class="abilities-title">Streetwise</span>						
							<span class="inv-ability">
								<input class="available" name="attr_streetwise" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="streetwise_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="streetwise_dec"></label>
								</div><span>/</span><input class="max" name="attr_streetwise_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="streetwise_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="streetwise_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_streetwise_free" type="number" value="0" min="0">
						</div>
						<fieldset class="repeating_interpersonal">
							<div class="abilities-item">
								<input class="constraint" name="attr_r-interpersonal_constraint" type="hidden" value="abd">
								<input name="attr_r-interpersonal_dice" type="hidden" value="@{basic_roll}">
								<div class="rep-title">
									<input class="options-flag" type="checkbox" name="attr_r-interpersonal_options-flag" checked="checked">
									<span>y</span>
									<div class="options">
										<input type="text" name="attr_r-interpersonal_title">
									</div>
									<div class="display">
										<span type="roll" class="abilities-title rep-title"> <span name="attr_r-interpersonal_title"></span>
										</span>
									</div>
								</div>
								<span>
									<input class="available" name="attr_r-interpersonal" type="number"><div>
										<label class="increment"><input name="attr_r-interpersonal_inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-interpersonal_dec" type="checkbox" value="1"></label>
									</div><span>/</span><input class="max" name="attr_r-interpersonal_max" type="number" value="0"><div>
										<label class="increment"><input name="attr_r-interpersonal_max-inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-interpersonal_max-dec" type="checkbox" value="1"></label>
									</div>
								</span>
								<input class="free-points" name="attr_r-interpersonal_free" type="number" value="0" min="0">
							</div>
						</fieldset>
						<div class="abilities-header">
							<span data-i18n="technical-abilities-nba" class="toc-hide">TECHNICAL ABILITIES</span>
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_chemistry_constraint" type="hidden" value="abd">
							<input name="attr_chemistry_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="chemistry-a" class="abilities-title">Chemistry</span>						
							<span class="inv-ability">
								<input class="available" name="attr_chemistry" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="chemistry_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="chemistry_dec"></label>
								</div><span>/</span><input class="max" name="attr_chemistry_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="chemistry_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="chemistry_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_chemistry_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_cryptography_constraint" type="hidden" value="abd">
							<input name="attr_cryptography_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="cryptography-a" class="abilities-title">Cryptography</span>						
							<span class="inv-ability">
								<input class="available" name="attr_cryptography" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="cryptography_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="cryptography_dec"></label>
								</div><span>/</span><input class="max" name="attr_cryptography_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="cryptography_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="cryptography_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_cryptography_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_criminology_constraint" type="hidden" value="abd">
							<input name="attr_criminology_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="criminology-a" class="abilities-title">Criminology</span>						
							<span class="inv-ability">
								<input class="available" name="attr_criminology" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="criminology_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="criminology_dec"></label>
								</div><span>/</span><input class="max" name="attr_criminology_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="criminology_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="criminology_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_criminology_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_data-recovery_constraint" type="hidden" value="abd">
							<input name="attr_data-recovery_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="data-recovery-a" class="abilities-title">Data Recovery</span>						
							<span class="inv-ability">
								<input class="available" name="attr_data-recovery" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="data-recovery_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="data-recovery_dec"></label>
								</div><span>/</span><input class="max" name="attr_data-recovery_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="data-recovery_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="data-recovery_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_data-recovery_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_electronic-surveillance_constraint" type="hidden" value="abd">
							<input name="attr_electronic-surveillance_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="electronic-surveillance-a" class="abilities-title">Electronic Surveillance</span>						
							<span class="inv-ability">
								<input class="available" name="attr_electronic-surveillance" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="electronic-surveillance_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="electronic-surveillance_dec"></label>
								</div><span>/</span><input class="max" name="attr_electronic-surveillance_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="electronic-surveillance_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="electronic-surveillance_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_electronic-surveillance_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_forensic-pathology_constraint" type="hidden" value="abd">
							<input name="attr_forensic-pathology_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="forensic-pathology-a" class="abilities-title">Forensic Pathology</span>						
							<span class="inv-ability">
								<input class="available" name="attr_forensic-pathology" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="forensic-pathology_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="forensic-pathology_dec"></label>
								</div><span>/</span><input class="max" name="attr_forensic-pathology_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="forensic-pathology_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="forensic-pathology_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_forensic-pathology_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_notice_constraint" type="hidden" value="abd">
							<input name="attr_notice_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="notice-a" class="abilities-title">Notice</span>						
							<span class="inv-ability">
								<input class="available" name="attr_notice" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="notice_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="notice_dec"></label>
								</div><span>/</span><input class="max" name="attr_notice_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="notice_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="notice_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_notice_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_outdoor-survival_constraint" type="hidden" value="abd">
							<input name="attr_outdoor-survival_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="outdoor-survival-a" class="abilities-title">Outdoor Survival</span>						
							<span class="inv-ability">
								<input class="available" name="attr_outdoor-survival" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="outdoor-survival_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="outdoor-survival_dec"></label>
								</div><span>/</span><input class="max" name="attr_outdoor-survival_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="outdoor-survival_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="outdoor-survival_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_outdoor-survival_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_pharmacy_constraint" type="hidden" value="abd">
							<input name="attr_pharmacy_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="pharmacy-a" class="abilities-title">Pharmacy</span>						
							<span class="inv-ability">
								<input class="available" name="attr_pharmacy" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="pharmacy_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="pharmacy_dec"></label>
								</div><span>/</span><input class="max" name="attr_pharmacy_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="pharmacy_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="pharmacy_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_pharmacy_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_photography_constraint" type="hidden" value="abd">
							<input name="attr_photography_dice" type="hidden" value="@{basic_roll}">
							<span data-i18n="photography-a" class="abilities-title">Photography</span>						
							<span class="inv-ability">
								<input class="available" name="attr_photography" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="photography_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="photography_dec"></label>
								</div><span>/</span><input class="max" name="attr_photography_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="photography_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="photography_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_photography_free" type="number" value="0" min="0">
						</div>
						<fieldset class="repeating_technical">
							<div class="abilities-item">
								<input class="constraint" name="attr_r-technical_constraint" type="hidden" value="abd">
								<input name="attr_r-technical_dice" type="hidden" value="@{basic_roll}">
								<div class="rep-title">
									<input class="options-flag" type="checkbox" name="attr_r-technical_options-flag" checked="checked">
									<span>y</span>
									<div class="options">
										<input type="text" name="attr_r-technical_title">
									</div>
									<div class="display">
										<span type="roll" class="abilities-title rep-title"><span name="attr_r-technical_title"></span></span>
									</div>
								</div>
								<span>
									<input class="available" name="attr_r-technical" type="number"><div>
										<label class="increment"><input name="attr_r-technical_inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-technical_dec" type="checkbox" value="1"></label>
									</div><span>/</span><input class="max" name="attr_r-technical_max" type="number" value="0"><div>
										<label class="increment"><input name="attr_r-technical_max-inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-technical_max-dec" type="checkbox" value="1"></label>
									</div>
								</span>
								<input class="free-points" name="attr_r-technical_free" type="number" value="0" min="0">
							</div>
						</fieldset>
					</div>
					<div class="abilities-col general">
						<div class="abilities-header">
							<span data-i18n="general-abilities-nba" class="toc-hide">GENERAL ABILITIES</span>
						</div>
						<div class="abilities-item npc-ability vampire toc-hide">
							<input class="constraint" name="attr_aberrance_constraint" type="hidden" value="abd">
							<input name="attr_aberrance_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="aberrance-a" type="roll" name="attr_aberrance_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{aberrance_dice} {{rname=^{aberrance-a}}}">
								Aberrance
							</button>
							<span>
								<input class="available" name="attr_aberrance" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="aberrance_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="aberrance_dec"></label>
								</div>
							</span>
						</div>
						<div class="abilities-item npc-ability vampire-hide">
							<input class="constraint" name="attr_athletics_constraint" type="hidden" value="abd">
							<input name="attr_athletics_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="athletics-a" type="roll" name="attr_athletics_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{athletics_dice} {{rname=^{athletics-a}}}">
								Athletics
							</button>
							<span>
								<input class="available" name="attr_athletics" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="athletics_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="athletics_dec"></label>
								</div><span>/</span><input class="max" name="attr_athletics_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="athletics_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="athletics_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_athletics_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_bureaucracy_constraint" type="hidden" value="abd">
							<input name="attr_bureaucracy_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="bureaucracy-a" type="roll" name="attr_bureaucracy_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{bureaucracy_dice} {{rname=^{bureaucracy-a}}}">
								Bureaucracy
							</button>
							<span>
								<input class="available" name="attr_bureaucracy" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="bureaucracy_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="bureaucracy_dec"></label>
								</div><span>/</span><input class="max" name="attr_bureaucracy_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="bureaucracy_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="bureaucracy_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_bureaucracy_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item npc-ability nba-npc">
							<input class="constraint" name="attr_driving_constraint" type="hidden" value="abd">
							<input name="attr_driving_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="driving-a" type="roll" name="attr_driving_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{driving_dice} {{rname=^{driving-a}}}">
								Driving
							</button>
							<span>
								<input class="available" name="attr_driving" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="driving_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="driving_dec"></label>
								</div><span>/</span><input class="max" name="attr_driving_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="driving_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="driving_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_driving_free" type="number" value="0" min="0">
							<fieldset class="repeating_r-drivings">
								<div class="subsection">
									<input type="text" name="attr_r-driving">
								</div>
							</fieldset>
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_explosive-devices_constraint" type="hidden" value="abd">
							<input name="attr_explosive-devices_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="explosive-devices-a" type="roll" name="attr_explosive-devices_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{explosive-devices_dice} {{rname=^{explosive-devices-a}}}">
								Explosive Devices
							</button>
							<span>
								<input class="available" name="attr_explosive-devices" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="explosive-devices_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="explosive-devices_dec"></label>
								</div><span>/</span><input class="max" name="attr_explosive-devices_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="explosive-devices_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="explosive-devices_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_explosive-devices_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_filch_constraint" type="hidden" value="abd">
							<input name="attr_filch_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="filch-a" type="roll" name="attr_filch_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{filch_dice} {{rname=^{filch-a}}}">
								Filch
							</button>
							<span>
								<input class="available" name="attr_filch" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="filch_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="filch_dec"></label>
								</div><span>/</span><input class="max" name="attr_filch_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="filch_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="filch_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_filch_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item npc-ability">
							<input class="constraint" name="attr_firearms_constraint" type="hidden" value="abd">
							<input name="attr_firearms_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="firearms-a" type="roll" name="attr_firearms_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{firearms_dice} {{rname=^{firearms-a}}}">
								Firearms
							</button>
							<span>
								<input class="available" name="attr_firearms" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="firearms_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="firearms_dec"></label>
								</div><span>/</span><input class="max" name="attr_firearms_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="firearms_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="firearms_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_firearms_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_first-aid_constraint" type="hidden" value="abd">
							<input name="attr_first-aid_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="first-aid-a" type="roll" name="attr_first-aid_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{first-aid_dice} {{rname=^{first-aid-a}}}">
								First Aid
							</button>
							<span>
								<input class="available" name="attr_first-aid" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="first-aid_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="first-aid_dec"></label>
								</div><span>/</span><input class="max" name="attr_first-aid_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="first-aid_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="first-aid_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_first-aid_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_fleeing_constraint" type="hidden" value="abd">
							<input name="attr_fleeing_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="fleeing-a" type="roll" name="attr_fleeing_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{fleeing_dice} {{rname=^{fleeing-a}}}">
								Fleeing
							</button>
							<span>
								<input class="available" name="attr_fleeing" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="fleeing_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="fleeing_dec"></label>
								</div><span>/</span><input class="max" name="attr_fleeing_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="fleeing_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="fleeing_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_fleeing_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item npc-ability">
							<input class="constraint" name="attr_health_constraint" type="hidden" value="abd">
							<input name="attr_health_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="health-a" type="roll" name="attr_health_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{health_dice} {{rname=^{health-a}}}">
								Health
							</button>
							<span>
								<input class="available" name="attr_health" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="health_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="health_dec"></label>
								</div><span>/</span><input class="max" name="attr_health_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="health_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="health_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_health_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_infiltration_constraint" type="hidden" value="abd">
							<input name="attr_infiltration_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="infiltration-a" type="roll" name="attr_infiltration_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{infiltration_dice} {{rname=^{infiltration-a}}}">
								Infiltration
							</button>
							<span>
								<input class="available" name="attr_infiltration" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="infiltration_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="infiltration_dec"></label>
								</div><span>/</span><input class="max" name="attr_infiltration_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="infiltration_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="infiltration_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_infiltration_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_mechanics_constraint" type="hidden" value="abd">
							<input name="attr_mechanics_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="mechanics-a" type="roll" name="attr_mechanics_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{mechanics_dice} {{rname=^{mechanics-a}}}">
								Mechanics
							</button>
							<span>
								<input class="available" name="attr_mechanics" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="mechanics_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="mechanics_dec"></label>
								</div><span>/</span><input class="max" name="attr_mechanics_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="mechanics_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="mechanics_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_mechanics_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_preparedness_constraint" type="hidden" value="abd">
							<input name="attr_preparedness_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="preparedness-a" type="roll" name="attr_preparedness_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{preparedness_dice} {{rname=^{preparedness-a}}}">
								Preparedness
							</button>
							<span>
								<input class="available" name="attr_preparedness" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="preparedness_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="preparedness_dec"></label>
								</div><span>/</span><input class="max" name="attr_preparedness_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="preparedness_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="preparedness_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_preparedness_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item npc-ability">
							<input class="constraint" name="attr_scuffling_constraint" type="hidden" value="abd">
							<input name="attr_scuffling_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="scuffling-a" type="roll" name="attr_scuffling_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{scuffling_dice} {{rname=^{scuffling-a}}}">
								Scuffling
							</button>
							<span>
								<input class="available" name="attr_scuffling" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="scuffling_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="scuffling_dec"></label>
								</div><span>/</span><input class="max" name="attr_scuffling_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="scuffling_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="scuffling_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_scuffling_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_sense-trouble_constraint" type="hidden" value="abd">
							<input name="attr_sense-trouble_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="sense-trouble-a" type="roll" name="attr_sense-trouble_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{sense-trouble_dice} {{rname=^{sense-trouble-a}}}">
								Sense Trouble
							</button>
							<span>
								<input class="available" name="attr_sense-trouble" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="sense-trouble_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="sense-trouble_dec"></label>
								</div><span>/</span><input class="max" name="attr_sense-trouble_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="sense-trouble_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="sense-trouble_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_sense-trouble_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_shrink_constraint" type="hidden" value="abd">
							<input name="attr_shrink_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="shrink-a" type="roll" name="attr_shrink_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{shrink_dice} {{rname=^{shrink-a}}}">
								Shrink
							</button>
							<span>
								<input class="available" name="attr_shrink" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="shrink_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="shrink_dec"></label>
								</div><span>/</span><input class="max" name="attr_shrink_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="shrink_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="shrink_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_shrink_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_stability_constraint" type="hidden" value="abd">
							<input name="attr_stability_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="stability-a" type="roll" name="attr_stability_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{stability_dice} {{rname=^{stability-a}}}">
								Stability
							</button>
							<span>
								<input class="available" name="attr_stability" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="stability_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="stability_dec"></label>
								</div><span>/</span><input class="max" name="attr_stability_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="stability_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="stability_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_stability_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item">
							<input class="constraint" name="attr_stealth_constraint" type="hidden" value="abd">
							<input name="attr_stealth_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="stealth-a" type="roll" name="attr_stealth_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{stealth_dice} {{rname=^{stealth-a}}}">
								Stealth
							</button>
							<span>
								<input class="available" name="attr_stealth" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="stealth_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="stealth_dec"></label>
								</div><span>/</span><input class="max" name="attr_stealth_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="stealth_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="stealth_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_stealth_free" type="number" value="0" min="0">
						</div>
						<div class="abilities-item toc-hide">
							<input class="constraint" name="attr_surveillance_constraint" type="hidden" value="abd">
							<input name="attr_surveillance_dice" type="hidden" value="@{basic_roll}">
							<button data-i18n="surveillance-a" type="roll" name="attr_surveillance_roll" class="abilities-title"
								value="&{template:@{sheetswitch}} @{surveillance_dice} {{rname=^{surveillance-a}}}">
								Surveillance
							</button>
							<span>
								<input class="available" name="attr_surveillance" type="number"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="surveillance_inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="surveillance_dec"></label>
								</div><span>/</span><input class="max" name="attr_surveillance_max" type="number" value="0"><div>
									<label class="increment"><input name="attr_spinner" type="radio" value="surveillance_max-inc"></label>
									<label class="decrement"><input name="attr_spinner" type="radio" value="surveillance_max-dec"></label>
								</div>
							</span>
							<input class="free-points" name="attr_surveillance_free" type="number" value="0" min="0">
						</div>
						<fieldset class="repeating_general">
							<div class="abilities-item npc-ability">
								<input class="constraint" name="attr_r-general_constraint" type="hidden" value="abd">
								<input name="attr_r-general_dice" type="hidden" value="@{basic_roll}">
								<div class="rep-title">
									<input class="options-flag" type="checkbox" name="attr_r-general_options-flag" checked="checked">
									<span>y</span>
									<div class="options">
										<input type="text" name="attr_r-general_title">
									</div>
									<div class="display">
										<button type="roll" name="attr_r-general_roll" class="abilities-title rep-title"
											value="&{template:@{sheetswitch}} @{r-general_dice} {{rname=@{r-general_title}}}">
											<span name="attr_r-general_title"></span>
										</button>
									</div>
								</div>
								<span>
									<input class="available" name="attr_r-general" type="number"><div>
										<label class="increment"><input name="attr_r-general_inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-general_dec" type="checkbox" value="1"></label>
									</div><span>/</span><input class="max" name="attr_r-general_max" type="number" value="0"><div>
										<label class="increment"><input name="attr_r-general_max-inc" type="checkbox" value="1"></label>
										<label class="decrement"><input name="attr_r-general_max-dec" type="checkbox" value="1"></label>
									</div>
								</span>
								<input class="free-points" name="attr_r-general_free" type="number" value="0" min="0">
							</div>
						</fieldset>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Weapons -->
	<div class="toc-col2 toc-right nba-col2 nba-right npc-full">
		<div class="section">
			<div class="content weapons">
				<h2 data-i18n="weapons-w" class="nba-caps">Weapons</h2>

				<div class="weapon unarmed">
					<input class="options-flag" type="checkbox" name="attr_weapon-options-flag"><span>y</span>
					<div class="options">
						<div style="position: relative">
							<div class="weapon-options">
								<div class="options-col">
									<div class="input-row">
										<span class="additional"><span data-i18n="adjust:-w">Adjust: </span><input type="number" name="attr_unarmed_adjust" value="0"></span>
									</div>
								</div>
								<div class="options-col">
									<div class="mod-display mod-display-melee">
										<div>
											<span data-i18n="damage:-w">Damage: </span>
											<span class="mod-display" name="attr_unarmed_mod"></span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="display">
						<span data-i18n="unarmed-attack" class="weapon-name">Unarmed Attack</span>
						<div class="weapon-rollers">
							<button type="roll" value="&{template:@{sheetswitch}-weapon} {{name=@{character_name}}} {{roll=[[1d6+@{unarmed_mod}]]}} {{rname=^{unarmed-attack}}}">
								<b data-i18n="attack-w">Attack</b>(<span name="attr_unarmed_mod"></span>)
							</button>
						</div>
					</div>
					<input type="hidden" name="attr_unarmed_mod" value="-2">
				</div>

				<fieldset class="repeating_weapons">
					<div class="weapon">
						<input type="hidden" name="attr_weapon-type-flag" value="m">
						<input class="options-flag" type="checkbox" name="attr_weapon-options-flag" checked="checked"><span>y</span>
						<div class="options">
							<div class="options-col">
								<div class="input-row">
									<label data-i18n="name:-n">Name:</label>
									<input type="text" name="attr_weapon" placeholder="Weapon Name">
								</div>
							</div>

							<div style="position: relative">
								<input class="category ranged" type="radio" name="attr_category" value="ranged" checked="true"><span data-i18n="ranged-w">Ranged</span>
								<input class="category melee" type="radio" name="attr_category" value="melee"><span data-i18n="melee-w">Melee</span>
								<div class="weapon-options ranged-options">
									<div class="options-col">
										<select name="attr_weapon-type">
											<option data-i18n="pistol-submachine-gun" class="toc-hide" value="pistol">Pistol/Submachine Gun</option>
											<option data-i18n="shotgun" value="shotgun">Shotgun</option>
											<option data-i18n="rifle" value="rifle">Rifle</option>
											<option data-i18n="thrown-w" class="toc-hide" value="thrown">Thrown</option>
											<option data-i18n="other" value="other">Other</option>
										</select>
									</div>
									<div class="options-col">
										<div class="input-row">
											<label>
												<input type="radio" name="attr_ranged_weight" value="0" checked="true">
												<span data-i18n="light-w"> Light</span>
											</label>
											<label>
												<input type="radio" name="attr_ranged_weight" value="1">
												<span data-i18n="heavy-w"> Heavy</span>
											</label>
											<label>
												<input type="radio" name="attr_ranged_weight" value="2">
												<span data-i18n="very-heavy-w"> Very Heavy</span>
											</label>
										</div>
									</div>
									<div class="mod-display">
										<div>
											<span data-i18n="point-blank-w">Point-Blank</span>
											<span class="additional"><span data-i18n="adjust:-w">Adjust: </span><input type="number" name="attr_point-blank_adjust" value="0"></span>
											<span class="mod-display" name="attr_point-blank_mod"></span>
										</div>
										<div>
											<span data-i18n="close-w">Close</span>
											<span class="additional"><span data-i18n="adjust:-w">Adjust: </span><input type="number" name="attr_close_adjust" value="0"></span>
											<span class="mod-display" name="attr_close_mod"></span>
										</div>
										<div>
											<span data-i18n="near-w">Near</span>
											<span class="additional"><span data-i18n="adjust:-w">Adjust: </span><input type="number" name="attr_near_adjust" value="0"></span>
											<span class="mod-display" name="attr_near_mod"></span>
										</div>
										<div class="long-range">
											<span data-i18n="long-w">Long</span>
											<span class="additional"><span data-i18n="adjust:-w">Adjust: </span><input type="number" name="attr_long_adjust" value="0"></span>
											<span class="mod-display" name="attr_long_mod"></span>
											<span data-i18n="out-of-range-w" class="range-message">(Out of Range)</span>
											<span data-i18n="extended-range-w" class="ex-range-message">(Extended Range)</span>
										</div>
									</div>
								</div>
								<div class="weapon-options melee-options">
									<div class="options-col">
										<div class="input-row">
											<label>
												<input type="radio" name="attr_melee_weight" value="-1" checked="true">
												<span data-i18n="light-w"> Light</span>
											</label>
										</div>
										<div class="input-row">
											<label>
												<input type="radio" name="attr_melee_weight" value="0">
												<span data-i18n="heavy-w"> Heavy</span>
											</label>
										</div>
										<div class="input-row">
											<label>
												<input type="radio" name="attr_melee_weight" value="1">
												<span data-i18n="very-heavy-w"> Very Heavy</span>
											</label>
										</div>
									</div>
									<div class="options-col">
										<div class="mod-display mod-display-melee">
											<div>
												<span class="additional"><span data-i18n="adjust:-w">Adjust: </span><input type="number" name="attr_melee_adjust" value="0"></span>
												<span data-i18n="damage:-w">Damage: </span>
												<span class="mod-display" name="attr_melee_mod"></span>
											</div>
										</div>
									</div>
								</div>
							</div>
							<input type="hidden" name="attr_point-blank_mod" value="+2">
							<input type="hidden" name="attr_close_mod" value="+0">
							<input type="hidden" name="attr_near_mod" value="+0">
							<input type="hidden" name="attr_long_mod" value="+0">
							<input type="hidden" name="attr_melee_mod" value="+0">
							<input type="hidden" name="attr_point-blank_roll" value="{{roll=[[1d6+2]]}}">
							<input type="hidden" name="attr_close_roll" value="{{roll=[[1d6]]}}">
							<input type="hidden" name="attr_near_roll" value="{{roll=[[1d6]]}}">
							<input type="hidden" name="attr_long_roll" value="{{roll=[[1d6]]}}">
							<input type="hidden" name="attr_melee_roll" value="{{roll=[[1d6]]}}">

						</div>
						<div class="display">
							<span class="weapon-name" name="attr_weapon"></span>
							<div class="weapon-rollers">
								<button type="roll" class="melee-button" value="&{template:@{sheetswitch}-weapon} {{name=@{character_name}}} @{melee_roll} {{rname=@{weapon}}}">
									<b data-i18n="attack-w">Attack</b>(<span name="attr_melee_mod"></span>)
								</button>
								<button  type="roll" value="&{template:@{sheetswitch}-weapon} {{name=@{character_name}}} @{point-blank_roll} {{rname=@{weapon}}}">
									<b data-i18n="point-blank-w">Point-Blank</b>(<span name="attr_point-blank_mod"></span>)
								</button>
								<button  type="roll" value="&{template:@{sheetswitch}-weapon} {{name=@{character_name}}} @{close_roll} {{rname=@{weapon}}}">
									<b data-i18n="close-w">Close</b>(<span name="attr_close_mod"></span>)
								</button>
								<button  type="roll" value="&{template:@{sheetswitch}-weapon} {{name=@{character_name}}} @{near_roll} {{rname=@{weapon}}}">
									<b data-i18n="near-w">Near</b>(<span name="attr_near_mod"></span>)
								</button>
								<button type="roll" class="long-range" value="&{template:@{sheetswitch}-weapon} {{name=@{character_name}}} @{long_roll} {{rname=@{weapon}}}">
									<b data-i18n="long-w" class="long">Long</b><b data-i18n="slash-extended" class="slash">/Extended</b><b data-i18n="parenthetical-extended" class="extended">(Extended)</b>(<span name="attr_long_mod"></span>)
								</button>
							</div>
						</div>
					</div>
				</fieldset>

			</div>
		</div>
	</div>

	<!-- Vampire Stats -->
	<div class="npc-full vampire toc-hide nba-hide">
		<div class="section content">
			<div class="nba-col1">
				<b data-i18n="powers-v" class="nba-caps">Powers</b>
				<fieldset class="repeating_r-powers">
					<div class="subsection">
						<input type="text" name="attr_r-power">
					</div>
				</fieldset>
			</div>
			<div class="nba-col1">
				<b data-i18n="banes-v" class="nba-caps">Banes</b>
				<fieldset class="repeating_r-banes">
					<div class="subsection">
						<input type="text" name="attr_r-bane">
					</div>
				</fieldset>
			</div>
			<div class="nba-col1">
				<b data-i18n="compulsions-v" class="nba-caps">Compulsions</b>
				<fieldset class="repeating_r-compulsions">
					<div class="subsection">
						<input type="text" name="attr_r-compulsion">
					</div>
				</fieldset>
			</div>
			<div class="nba-col1">
				<b data-i18n="dreads-v" class="nba-caps">Dreads</b>
				<fieldset class="repeating_r-dreads">
					<div class="subsection">
						<input type="text" name="attr_r-dread">
					</div>
				</fieldset>
			</div>
			<div class="nba-col1">
				<b data-i18n="requirements-v" class="nba-caps">Requirements</b>
				<fieldset class="repeating_r-requirements">
					<div class="subsection">
						<input type="text" name="attr_r-requirement">
					</div>
				</fieldset>
			</div>
			<div class="nba-col1">
				<b data-i18n="blocks-v" class="nba-caps">Blocks</b>
				<fieldset class="repeating_r-blocks">
					<div class="subsection">
						<input type="text" name="attr_r-block">
					</div>
				</fieldset>
			</div>
		</div>
	</div>
	<!-- Contacts/Covers, Etc. -->
	<div class="nba-full nba-left toc-hide npc-hide">
		<div class="section content">
			<div class="nba-col1">
				<b data-i18n="covers" class="nba-caps">Covers</b>
				<fieldset class="repeating_r-covers">
					<div class="subsection-num">
						<input type="text" name="attr_r-cover">
						<input name="attr_r-cover-n" type="number" value="1">
					</div>
				</fieldset>
			</div>
			<div class="nba-col1">
				<b data-i18n="network-contacts" class="nba-caps">Network Contacts</b>
				<fieldset class="repeating_r-contacts">
					<div class="subsection-num">
						<input type="text" name="attr_r-contact">
						<input name="attr_r-contact-n" type="number" value="1">
					</div>
				</fieldset>
			</div>
			<div class="nba-col1">
				<b data-i18n="trust" class="nba-caps">Trust</b>
				<fieldset class="repeating_r-trusts">
					<div class="subsection">
						<input type="text" name="attr_r-trust">
					</div>
				</fieldset>
			</div>
		</div>
	</div>
	<!-- Notes -->
	<div class="notes-full nba-full section toc-col2 npc-full">
		<div class="content">
			<div data-i18n="notes-n">Notes</div>
			<textarea name="attr_notes"></textarea>
		</div>
	</div>
</div>

<!-- Hidden Attributes -->
<input type="hidden" name="attr_version" value="0">
<input type="hidden" name="attr_academic_points" value="0">
<input type="hidden" name="attr_r-academic_points" value="0">
<input type="hidden" name="attr_interpersonal_points" value="0">
<input type="hidden" name="attr_r-interpersonal_points" value="0">
<input type="hidden" name="attr_technical_points" value="0">
<input type="hidden" name="attr_r-technical_points" value="0">
<input type="hidden" name="attr_general_points" value="0">
<input type="hidden" name="attr_r-general_points" value="0">
<input type="hidden" name="attr_inv_points" value="0">
<input type="hidden" name="attr_gen_points" value="0">
<input type="hidden" name="attr_hit-rating" value="3">
<input type="hidden" name="attr_point_query" value="{{name=@{character_name}}} {{points=[[?{Spend|0}]]}} {{roll=[[1d6+?{Spend}]]}}">
<input type="hidden" name="attr_basic_roll" value="{{name=@{character_name}}} {{roll=[[1d6]]}}">
<input type="hidden" name="attr_automatic_query" value="{{automatic=[[?{Full Auto|No,0|Yes,2}]]}} {{roll=[[1d6+?{Full Auto}">
<input type="hidden" name="attr_automatic-heavy_query" value="{{automatic=[[?{Full Auto|No,0|Yes,3}]]}} {{roll=[[1d6+?{Full Auto}">
<input type="hidden" name="attr_barrels_query" value="{{barrels=[[?{Both barrels|No,0|Yes,1}]]}} {{roll=[[1d6+?{Both barrels}">

<div class="rolltemplates">
	<rolltemplate class="sheet-rolltemplate-toc">
		<div class="name">
			{{name}}
		</div>
		<div class="result">
			{{roll}}
		</div>
		{{#rollGreater() points 0}}
			<div class="points">
				<span data-i18n="point-spend">Points spent: </span>{{points}}
			</div>
		{{/rollGreater() points 0}}
		<div class="label">
			{{rname}}
		</div>
	</rolltemplate>

	<rolltemplate class="sheet-rolltemplate-toc-weapon">
		<div class="name">
			{{name}}
		</div>
		<div class="label">
			{{rname}}
		</div>
		{{#rollGreater() automatic 0}}
			<div data-i18n="full-auto" class="points">
				Full auto
			</div>
		{{/rollGreater() automatic 0}}
		{{#rollGreater() barrels 0}}
			<div data-i18n="both-barrels" class="points">
				Both barrels
			</div>
		{{/rollGreater() barrels 0}}
		<div class="result">
			{{roll}}
		</div>
	</rolltemplate>

	<rolltemplate class="sheet-rolltemplate-nba">
		<div class="name">
			{{name}}
		</div>
		<div class="result">
			{{roll}}
		</div>
		{{#rollGreater() points 0}}
			<div class="points">
				<span data-i18n="point-spend">Points spent: </span>{{points}}
			</div>
		{{/rollGreater() points 0}}
		<div class="label">
			{{rname}}
		</div>
	</rolltemplate>

	<rolltemplate class="sheet-rolltemplate-nba-weapon">
		<div class="name">
			{{name}}
		</div>
		<div class="label">
			{{rname}}
		</div>
		<div class="result">
			{{roll}}
		</div>
	</rolltemplate>
</div>

</div>

<script type="text/worker">
//changes: occult -> occult-studies; Assess Honesty -> Bullshit Detector; Outdoorsman -> Outdoor Survival; Explosives -> Explosive Devices;
// Mechanical Repair -> Mechanics; 
var currentAbilities = {},
	reverseAbilities = {},
	allAbilities = ["accounting", "anthropology", "archaeology", "architecture", "art", "art-history", "art-hsitory", "assess-honesty", "astronomy", "athletics", "bargain", "biology", "bullshit-detector", "bureaucracy", "chemistry", "conceal", "cop-talk", "cover", "craft", "credit-rating", "criminology", "cryptography", "cthulhu-mythos", "data-recovery", "diagnosis", "digital-intrusion", "disguise", "driving", "electrical-repair", "electronic-surveillance", "evidence-collection", "explosive-devices", "explosives", "filch", "firearms", "first-aid", "flattery", "fleeing", "flirting", "forensic-pathology", "forensics", "forgery", "gambling", "geology", "hand-to-hand", "health", "high-society", "history", "human-terrain", "hypnosis", "infiltration", "interrogation", "intimidation", "languages", "law", "library-use", "locksmith", "mechanical-repair", "mechanics", "medic", "medicine", "military-science", "negotiation", "network", "notice", "occult", "occult-studies", "oral-history", "outdoorsman", "outdoor-survival", "pharmacy", "photography", "physics", "piloting", "preparedness", "psychoanalysis", "reassurance", "research", "riding", "sanity", "scuffling", "sense-trouble", "shadowing", "shooting", "shrink", "stability", "stealth", "streetwise", "surveillance", "theology", "tradecraft", "traffic-analysis", "urban-survival", "vampirology"],
	system = 'toc',
	npc = false,
	sections = ['academic', 'interpersonal', 'technical', 'general'],
	pointChange = ['inc', 'dec', 'max-inc', 'max-dec', '', 'max'],
	maxChange = ['occupation', 'max', 'free'],

	changeString = function(elementList, endings = [""], repeating = false) {
		let string = '';
		if(repeating) {
			_.each(elementList, function(element) {
				_.each(endings, function(ending) {
					string += ' change:repeating_' + element + ':r-' + element;
					string += (ending == '') ? '' : '_' + ending;
				});
			});
		} else {
			_.each(elementList, function(element) {
				_.each(endings, function(ending) {
					string += ' change:' + element;
					string += (ending == '') ? '' : '_' + ending;
				});
			});
		}
		return string;
	},

	getAbility = function(trigger) {
		return trigger ? trigger.split("_") : false;
	},

	abilityList = function(elementList, endings, repeating = false) {
		let returnList = [],
			prefix = repeating ? repeating : '';
		_.each(elementList, function(element) {
			_.each(endings, function(ending) {
				let underscore = ending == '' ? '' : '_';
				returnList.push(prefix + element + underscore + ending);
			});
		});
		return returnList;
	},

	returnInt = function(x) {
		return isNaN(x) ? "" : parseInt(x);
	},

	makeRepeatingArray = function(section, repIds) {
		let result = [];

		_.each(repIds, function(repId) {
			result.push('repeating_' + section + '_' + repId + '_r-' + section);
		});
		return result;
	},

	getRepeating = function(secArray, callback, resultArray = [], returnSecs = []) {
		let tempArray = [].concat(secArray);

		if(tempArray.length > 0) {
			let x = tempArray.pop();
			getSectionIDs(x, function(repIds) {
				resultArray = resultArray.concat(makeRepeatingArray(x, repIds));
				returnSecs.push(x);
				getRepeating(tempArray, callback, resultArray, returnSecs);
			});
		} else {
			callback(resultArray, returnSecs);
		}
	},

	getSectionTotal = function(secs = {}, eventInfo = {category: false}, repeating = false) {
		let aList = [],
			pointList = abilityList(sections, ['points']);
		pointList = pointList.concat(abilityList(sections, ['points'], 'r-'));

		if(eventInfo.category) {
			aList = aList.concat(abilityList(secs, maxChange.concat([""])));
		} else {
			_.each(sections, function(sec) {
				aList = aList.concat(abilityList(currentAbilities[sec], maxChange));
			});
		}

		getAttrs(aList.concat(pointList), function(values) {
			let result = {},

				current = repeating ? 'r-' + eventInfo.category + '_points' : eventInfo.category + '_points',

				computePoints = function(abilities) {
					let result = 0;
					_.each(abilities, function(ability) {
						let max = parseInt(values[ability + "_max"]),
							occupation = values[ability + "_occupation"];
						if(ability == 'fleeing') {
							let ath = values['athletics_max'] ? parseInt(values['athletics_max']) : 0;
							if(ath == 0 || occupation == 0.5) {
								max = Math.max(max - values[ability + "_free"], 0);
								occupation = 0.5;
							}
							else if(2*ath < max){
								max = ath + 0.5*max; //Fleeing points cost half when having more than (2*athletics points) amount of fleeing   (ToC p.26) 
							}else{
								max = Math.max(max - values[ability + "_free"], 0);
							}
						} else {
							max = Math.max(max - values[ability + "_free"], 0);
						}
						occupation = system == 'toc' ? occupation : 0;
						result += max ? Math.ceil(max * (1 - occupation)) : 0;
					});

					return result;
				},

				setResult = function() {
					result['inv_points'] = 0;
					result['gen_points'] = 0;
					_.each(['academic', 'interpersonal', 'technical'], function(sec) {
						result['inv_points'] += parseInt(result[sec + '_points']) + parseInt(result['r-' + sec + '_points']);
					});
					result['gen_points'] += parseInt(result['general_points']) + parseInt(result['r-general_points']);
					setAttrs(result);
				};

			if(eventInfo.category) {
				_.each(pointList, function(sec) {
					result[sec] = parseInt(values[sec]);
				});
				result[current] = 0;

				result[current] = computePoints(secs);

				if(eventInfo.sourceAttribute.substr(-4) == 'free') {
					let oldVal = 0, diff = 0,
						trigger = eventInfo.sourceAttribute.slice(0,-5),
						newVal = parseInt(values[trigger + '_free']);

					if(eventInfo.previousValue) {
						oldVal = parseInt(eventInfo.previousValue);
						if(oldVal == newVal) {
							oldVal = 0;
						}
					}

					diff = newVal - oldVal;

					result[trigger + '_max'] = Math.max(parseInt(values[trigger + '_max']) + diff, 0);
					result[trigger] = Math.max(parseInt(values[trigger]) + diff, 0);
				}
				setResult(result);

			} else {
				let idResult = [];

				result = secs;

				_.each(pointList, function(sec) {
					result[sec] = 0;
				});

				_.each(sections, function(sec) {
					result[sec + '_points'] += computePoints(currentAbilities[sec]);
				});

				getRepeating(sections, function(resultArray) {
					getAttrs(abilityList(resultArray, maxChange), function(vals) {
						_.each(resultArray, function(rAbility) {
							let max = vals[rAbility + "_max"],
								occupation = vals[rAbility + "_occupation"];

							occupation = system == 'toc' ? occupation : 0;
							result[rAbility.split('_')[3] + '_points'] += max ? Math.ceil(max * (1 - occupation)) : 0;
						});
						setResult();
					});
				});

			}
		});
	},

	abilityChange = function(trigger, repeating = false) {
		if (trigger == false) {
			return;
		}

		let ability = trigger[0],
			source = trigger[1],
			max = ability + "_max",
			constraint = ability + "_constraint",
			free = ability + "_free",
			noCherry = ["health", "stability", "cover", "network"];

		getAttrs([ability, max, free, "cherry-branch-height"], function(values) {
			let change = {},
				maxMin = npc ? 0 : parseInt(values[free]),
				min = ["health", "stability"].indexOf(ability) == -1 ? 0 : -12;

			change[ability] = returnInt(values[ability]);
			change[max] = returnInt(values[max]);
			change[constraint] = " ";

			if(source == "inc") {
				change[ability] = change[ability] ? change[ability] + 1 : 1;
			}
			if(source == "dec") {
				change[ability] -= 1;
			}

			if(source == "max-inc") {
				change[max] = change[max] ? change[max] : 0;
				change[ability] = change[ability] ? change[ability] : 0;
				if(change[ability] == change[max]) {
					change[ability] = change[max] + 1;
				}
				change[max] += 1;
			}
			if(source == "max-dec") {
				if(change[ability] == change[max]) {
					change[ability] = change[max] - 1;
				}
				change[max] -= 1;
			}

			if(change[max] <= maxMin) {
				change[constraint] += "d";
				change[max] = maxMin ? maxMin : "";
			}
			if(change[ability] >= change[max]) {
				change[constraint] += "a";
			}
			if(change[ability] <= min) {
				change[constraint] += "b";
				change[ability] = change[max] ? min : "";
			}

			if(values[ability] == "" && values[max] == 0) {
				change[ability] = change[max];
			}

			if(ability == 'athletics' && !npc) {
				change['hit-rating'] = change[max] >= 8 ? 4 : 3;
			}

			if(change[ability] <= -10) {
				change[constraint] += 's';
			}

			if(parseInt(change[ability]) > 0) {
				change[ability + "_dice"] = "@{point_query}";
			} else {
				change[ability + "_dice"] = "@{basic_roll}";
			}

			if(npc) {
				change[ability] = change[ability] == "" ? 0 : change[ability];
			}

			if(change[ability] >= values["cherry-branch-height"] && noCherry.indexOf(ability) == -1) {
				change[constraint] += "x";
			}

			setAttrs(change);

		});
	};

on("sheet:opened change:sheetsettings", function(eventInfo) {
	let systemAbilities = {
			tocAcademic: ['accounting', 'anthropology', 'archaeology', 'architecture', 'art-history', 'biology', 'cthulhu-mythos', 'cryptography', 'geology', 'history', 'languages', 'law', 'library-use', 'medicine', 'occult', 'physics', 'theology'],
			tocInterpersonal: ['assess-honesty', 'bargain', 'bureaucracy', 'cop-talk', 'credit-rating', 'flattery', 'interrogation', 'intimidation', 'oral-history', 'reassurance', 'streetwise'],
			tocTechnical: ['art', 'astronomy', 'chemistry', 'craft', 'evidence-collection', 'forensics', 'locksmith', 'outdoorsman', 'pharmacy', 'photography'],
			tocGeneral: ['athletics', 'conceal', 'disguise', 'driving', 'electrical-repair', 'explosives', 'filch', 'firearms', 'first-aid', 'fleeing', 'health', 'hypnosis', 'mechanical-repair', 'piloting', 'preparedness', 'psychoanalysis', 'riding', 'sanity', 'scuffling', 'sense-trouble', 'shadowing', 'stability', 'stealth', 'weapons'],
			nbaAcademic: ['accounting', 'archaeology', 'architecture', 'art-history', 'criminology', 'diagnosis', 'history', 'human-terrain', 'languages', 'law', 'military-science', 'occult-studies', 'research', 'vampirology'],
			nbaInterpersonal: ['bullshit-detector', 'bureaucracy', 'cop-talk', 'flattery', 'flirting', 'high-society', 'interrogation', 'intimidation', 'negotiation', 'reassurance', 'streetwise', 'tradecraft'],
			nbaTechnical: ['astronomy', 'chemistry', 'cryptography', 'data-recovery', 'electronic-surveillance', 'forensic-pathology', 'forgery', 'notice', 'outdoor-survival', 'pharmacy', 'photography', 'traffic-analysis', 'urban-survival'],
			nbaGeneral: ['athletics', 'conceal', 'cover', 'digital-intrusion', 'disguise', 'driving', 'explosive-devices', 'filch', 'gambling', 'hand-to-hand', 'health', 'infiltration', 'mechanics', 'medic', 'network', 'piloting', 'preparedness', 'sense-trouble', 'shooting', 'shrink', 'stability', 'surveillance', 'weapons']};

	getAttrs(["health_default", "stability_default", "sanity_default", "cover_default", "network_default", "sheetsettings", "firstopen", "gen_points_default", "inv_points_default"], function(values) {
		let updates = {version: 0.5};

		system = values.sheetsettings;
		_.each(sections, function(section) {
			tempArray = systemAbilities[system + section[0].toUpperCase() + section.substr(1)];
			currentAbilities[section] = tempArray;
			_.each(tempArray, function(ability) {
				reverseAbilities[ability] = section;
			});
		});

		if(!values.firstopen) {
			_.each(["health", "stability", "sanity", "cover", "network"], function(ability) {
				updates[ability + '_free'] = values[ability + "_default"];
				if(!npc) {
					updates[ability + '_max'] = updates[ability + "_free"];
					updates[ability] = updates[ability + "_free"];
				}
			});

			["gen_points", "inv_points"].forEach((ability) => {
				updates[ability] = 0;
				updates[`${ability}_max`] = values[`${ability}_default`];
			});
			console.log(updates);

			updates.sanity_marker = updates.sanity_free;
			updates.firstopen = 1;
		}

		if(system == "toc") {
			updates.vampswitch = 0;
		}

		updates.sheetswitch = values.sheetsettings;
		setAttrs(updates, {}, function() {
			getSectionTotal();
		});
	});
});

on(changeString(["health", "stability"], ["default"]), function(eventInfo) {
	let trigger = eventInfo.sourceAttribute.split('_')[0],
		updates = {};

	updates[trigger + '_free'] = eventInfo.newValue;
	setAttrs(updates);
});

on("change:npcswitch", function(eventInfo) {
	let abilities = ["aberrance", "athletics", "conceal", "driving", "firearms", "hand-to-hand", "health", "medic", "scuffling", "shooting", "weapons"],
		abilityVal = 0,
		updates = {};

	if(parseInt(eventInfo.newValue) == 1) {
		updates["edit-abilities"] = 0;
		npc = true;
	} else {
		updates["edit-abilities"] = 1;
		abilityVal = "";
		npc = false;
	}

	_.each(abilities, function(x) {
		updates[x] = abilityVal;
	});

	if(npc) {
		setAttrs(updates);
	} else {
		getAttrs(abilityList(abilities, ["free"]), function(values) {
			_.each(abilities, function(ability) {
				if(values[ability + '_free']) {
					updates[ability + '_max'] = values[ability + '_free'];
					updates[ability] = values[ability + '_free'];
				}
			});
			setAttrs(updates);
		});
	}
});

on(changeString(allAbilities) + " change:spinner", function(eventInfo) {
	let trigger = eventInfo.sourceAttribute,
		resetAbilities = function(sectionArray) {
			getRepeating(sectionArray, function(resultArray, returnedSecs) {
				let secAbilities = [],
					fullList = []; //resultArray.concat(allAbilities);

				_.each(returnedSecs, function(sec) {
					secAbilities = secAbilities.concat(currentAbilities[sec]);
				});

				fullList = resultArray.concat(secAbilities);

				getAttrs(abilityList(fullList, ['max', '']), function(vals) {
					let results = {},
						noReset = ["sanity", "health", "stability", "cover", "network"];

					_.each(fullList, function(ability) {
						if(vals[ability] != vals[ability + '_max'] && vals[ability + '_max'] != "0") {
							if(noReset.indexOf(ability) == -1) {
								results[ability] = vals[ability + '_max'];
							}
						}
					});

					setAttrs(results);
				});
			});
		};

	if(trigger) {
		if(trigger == "spinner") {
			getAttrs(["spinner"], function(values) {
				setAttrs({spinner: ""}, {silent: true});
				if(values.spinner == "reset-inv") {
					resetAbilities(["academic", "interpersonal", "technical"]);
				} else if(values.spinner == "reset-gen") {
					resetAbilities(["general"]);
				}
				else {
					abilityChange(getAbility(values.spinner));
				}
			});
		} else {
			abilityChange(getAbility(trigger));
		}
	}
});

on(changeString(sections, pointChange, true), function(eventInfo) {
	let triggerArray = eventInfo.sourceAttribute.split('_'),
		trigger = triggerArray.pop();
	triggerArray.splice(2, 1);
	abilityChange([triggerArray.join('_'), trigger], true);
});

on(changeString(allAbilities, maxChange), function(eventInfo) {
	eventInfo.category = reverseAbilities[eventInfo.sourceAttribute.split('_')[0]];
	if(!npc) {
		getSectionTotal(currentAbilities[eventInfo.category], eventInfo);
	}
	getAttrs([eventInfo.sourceAttribute], function(values) {
		console.log(values[eventInfo.sourceAttribute])
	});
});

on(changeString(sections, maxChange, true), function(eventInfo) {
	eventInfo.category = eventInfo.sourceAttribute.split('_')[1];
	if(!npc) {
		getSectionIDs(eventInfo.category, function(repIds) {
			let nameArray = makeRepeatingArray(eventInfo.category, repIds);
			getSectionTotal(nameArray, eventInfo, true);
		});
	}
});

on("change:repeating_weapons", function(eventInfo) {
	if(eventInfo.sourceAttribute.split('_').length > 3) {
		getAttrs(
			abilityList(["melee", "point-blank", "close", "near", "long"], ["adjust"], "repeating_weapons_").concat(
			abilityList(["weapon-type", "capacity", "category", "ranged_weight", "melee_weight", "automatic", "double-barreled", "weapon-type-flag"], [""], "repeating_weapons_")),
		function(values) {
			let prefix = "repeating_weapons_",
				results = {},
				rWeight = parseInt(values[prefix + "ranged_weight"]),
				pbWeight = rWeight,
				nlWeight = rWeight,
				cMod = 0,
				nMod = 0,
				lMod = 0,
				pbMod = 2,
				query = "",
				changeRoll = function(roll, weight, extra = "", base = "") {
					let fullQuery = extra == "" ? "" : "@{" + extra + "_query} ",
						addMod = function(mod) {
							if(mod == "") {
								return "";
							} else {
								let intMod = parseInt(mod);
								if(intMod != 0) {
									return intMod > 0 ? "+" + intMod : intMod;
								} else {
									return "";
								}
							}
						};
						results[prefix + roll +"_roll"] = extra ? fullQuery : "{{roll=[[1d6"
						results[prefix + roll +"_roll"] += addMod(base) + addMod(weight) + addMod(values[prefix + roll +"_adjust"]) + "]]}}";
					};
			results[prefix + "weapon-type-flag"] = values[prefix + "category"] == 'melee' ? 'm' : values[prefix + "weapon-type"][0];
			if(values[prefix + "category"] == "melee") {
				results[prefix + "melee_mod"] = parseInt(values[prefix + "melee_weight"]) + parseInt(values[prefix + "melee_adjust"]);
				changeRoll('melee', values[prefix + "melee_weight"]);
			} else {
				if(values[prefix + "weapon-type"] == "shotgun") {
					pbWeight = rWeight < 2 ? 1 : rWeight;
					nlWeight = 0;
					cMod = system == 'nba' ? 1 : 0;
					if(values[prefix + "double-barreled"] == "1") {
						query = "barrels";
					}
				}

				if(values[prefix + "weapon-type"] == "automatic") {
					results[prefix + "double-barreled"] = "";
					query = "automatic";
					if(parseInt(results[prefix + "capacity"]) >= 50) {
						query = "automatic-heavy";
					}
				}

				if(values[prefix + "weapon-type"] == "thrown") {
					rWeight -= 1;
					pbWeight -= 1;
					nlWeight -= 1;
					nMod = -1;
					lMod = -1;
					pbMod = 0;
				}

				results[prefix + "point-blank_mod"] = pbMod + pbWeight + parseInt(values[prefix + "point-blank_adjust"]);
				changeRoll('point-blank', pbWeight, query, pbMod);
				results[prefix + "close_mod"] = rWeight + cMod + parseInt(values[prefix + "close_adjust"]);
				changeRoll('close', rWeight, query, cMod);
				results[prefix + "near_mod"] = nlWeight + nMod + parseInt(values[prefix + "near_adjust"]);
				changeRoll('near', nlWeight, query, nMod);
				results[prefix + "long_mod"] = nlWeight +lMod + parseInt(values[prefix + "long_adjust"]);
				changeRoll('long', nlWeight, query, lMod);
			}
			for(let key in results) {
				if(key.substr(-4) == '_mod') {
					results[key.slice(0, -4)] = results[key];
					results[key] = results[key] >= 0 ? "+" + results[key] : results[key];
				}
			}
			setAttrs(results, {silent: true});
		});
	}
});

on("change:unarmed_adjust", function() {
	getAttrs(["unarmed_adjust"], function(values) {
		let results = {};

		results.unarmed_mod = parseInt(values.unarmed_adjust) - 2;
		setAttrs(results);
	}) ;
});

on("change:armor-type", function(eventInfo) {
	let updates = {};

	updates["bullet-reduction"] = 0;
	updates["melee-reduction"] = 0;
	updates["explosive-reduction"] = 0;

	switch(eventInfo.newValue) {
		case "balistic-cloth":
			updates["bullet-reduction"] = 1;
			break;
		case "police-vest":
			updates["bullet-reduction"] = 2;
			updates["melee-reduction"] = 1;
			break;
		case "military-armor":
			updates["bullet-reduction"] = 3;
			updates["explosive-reduction"] = 3;
	}

	setAttrs(updates);
});

on("change:repeating_general:r-mos", function(eventInfo) {
	if(eventInfo.newValue == "1") {
		let updates = {mos: "blank"};

		getSectionIDs("repeating_general", function(idArray) {
			console.log(idArray);
			_.each(idArray, function(abilityID){
				if(eventInfo.sourceAttribute != "repeating_general_" + abilityID + "_r-mos") {
					updates["repeating_general_" + abilityID + "_r-mos"] = 0;
				}
			});
			setAttrs(updates, {silent: true});
		});
	}
});

on("change:mos", function(eventInfo) {
	let updates = {};

	getSectionIDs("repeating_general", function(idArray) {
		_.each(idArray, function(abilityID){
			updates["repeating_general_" + abilityID + "_r-mos"] = 0;
		});
		console.log(updates);
		setAttrs(updates, {silent: true});
	});
});

</script>